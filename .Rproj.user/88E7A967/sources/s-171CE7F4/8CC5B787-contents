---
title: "Did Marvel film near you?"
subtitle: "SDS 192: Mini-Project 3"
author: 
- name: Kathleen Hablutzel
  affiliation: Smith College
date: "`r format(Sys.Date(), '%B %e, %Y')`"
output: 
  html_document:
    theme: united
    toc: true
    toc_depth: 2
    toc_float: true
    fig_width: 7
    fig_height: 6
    fig_caption: true
    code_folding: hide
    df_print: paged
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
library(tidyverse)
library(sds192)
library(RMySQL)
library(widgetframe)
db <- dbConnect(
  MySQL(), 
  host = "scidb.smith.edu", 
  user = "sds192", 
  password = "DSismfc@S", 
  dbname = "imdb"
)
knitr::opts_chunk$set(
  message = FALSE,
  echo = TRUE, 
  connection = db, 
  max.print = 60,
  widgetframe_widgets_dir = 'widgets'
)
```

Trigger Warning: Links to movie clips with gunfire and explosions are marked with \*.

## Exploring Marvel Production Locations

Marvel's [*Black Widow* movie](https://youtu.be/ybji16u608U)\* was supposed to hit theaters this weekend, kicking off Phase Four of the Marvel Cinematic Universe. Now delayed until November, the film explores Black Widow's origins, known to Marvel fans as the "[red in her ledger](https://youtu.be/qU58AtOuUd0?t=107)." IMDB reports [filming locations](https://www.imdb.com/title/tt3480822/locations?ref_=tt_dt_dt) in Hungary, Norway, Morocco, and Budapest, so fans may even learn exactly [what happened in Budapest](https://youtu.be/634gmV-WHo4?t=50)\*.

Over the years, plenty of locations from around the globe have found their way into the MCU. Tony Stark invents his Iron Man suit in the [desert of Afghanistan](https://youtu.be/zM7E4a8bGlQ?t=164)\*. Black Panther rules the fictional African country of [Wakanda](https://youtu.be/r8nxdAGg2FY?t=20). And [Doctor Strange](https://www.youtube.com/watch?v=HSzx-zryEgM) travels to Kathmandu, Nepal only to end up defending NYC, London, and Hong Kong. Do Marvel production teams travel to all these locations, or is it CGI movie magic?

With nowhere to go in quarantine, I took a trip around the world and mapped Marvel's filming locations as reported in IMDB.[^github]

[^github]: Please see [my GitHub repository](https://github.com/sds192-s20/mp3-group-h) for complete code. 

## Initial Findings: Popular Filming Sites

When I first searched IMDB for movies produced by Marvel Studios, I found some misfit movies from Marvel's early years such as [*Spider-Man 3* (2007)](https://www.imdb.com/title/tt0413300/) and [*Punisher: War Zone* (2008)](https://www.imdb.com/title/tt0450314/).

```{sql, connection=db, output.var="marvel_locations"}
-- filming locations of all Marvel Studios movies in this dataset
SELECT t.id, t.title, t.production_year, cn.name, mi.info site, mi.note
FROM imdb.title t
JOIN movie_companies mc ON t.id = mc.movie_id
JOIN company_name cn ON mc.company_id = cn.id
JOIN movie_info mi ON t.id = mi.movie_id
WHERE mi.info_type_id = 18 -- locations of
AND t.kind_id = 1 -- movies
AND cn.name = 'Marvel Studios' -- by Marvel
ORDER BY t.production_year; -- in order of production 
```

Since other production companies took the lead on those films, I limited my data to movies in the [Marvel Cinematic Universe (MCU)](https://en.wikipedia.org/wiki/Marvel_Cinematic_Universe), where plots intertwine and contribute to Marvel's consistent overall vision.[^Hulk]

[^Hulk]: I was reluctant to include [*The Incredible Hulk* (2008)](https://www.imdb.com/title/tt0800080/) for a few reasons: Universal Pictures owns distribution rights, Edward Norton was replaced by Mark Ruffalo in subsequent Marvel movies, and it's easy to leave it out of the MCU.

```{sql, connection=db, output.var="mcu_locations"}
-- filming locations of all MCU movies in this dataset
SELECT t.id, t.title, t.production_year, cn.name, mi.info site, mi.note
FROM imdb.title t
JOIN movie_companies mc ON t.id = mc.movie_id
JOIN company_name cn ON mc.company_id = cn.id
JOIN movie_info mi ON t.id = mi.movie_id
WHERE t.id IN ( -- movie list compiled based off previous query
	-- phase 1
	'3759353', '4369971', '3759356', '4454099',
	'3400748', '4316706',
  -- phase 2
  '3759369', '4454124', '3400755', '3665599',
  '3313672', '3292159',
  -- phase 3
  '3400744', '3521133', '3665600', '4252963',
  '4454122', '3358206', '3313680', '3292160',
  '3400994' -- missing Endgame and Far From Home
)
AND t.kind_id = 1 -- movie
AND cn.name = 'Marvel Studios' -- Marvel Studios
AND mi.info_type_id = 18 -- just location info
ORDER BY t.production_year; -- in order of production 
```

With an initial glance at Marvel movies' production locations, the most common filming locations are destination locations such as NYC, LA, and London. Marvel also works out of production studios in Georgia, California, and England.

```{sql, connection=db, output.var="top_locations"}
-- filming locations with most movies filmed there
SELECT mi.info site, sum(1) total_movies
FROM imdb.title t
JOIN movie_companies mc ON t.id = mc.movie_id
JOIN company_name cn ON mc.company_id = cn.id
JOIN movie_info mi ON t.id = mi.movie_id
WHERE t.id IN ( -- movie list compiled based off previous query
	-- phase 1
	'3759353', '4369971', '3759356', '4454099',
	'3400748', '4316706',
  -- phase 2
  '3759369', '4454124', '3400755', '3665599',
  '3313672', '3292159',
  -- phase 3
  '3400744', '3521133', '3665600', '4252963',
  '4454122', '3358206', '3313680', '3292160',
  '3400994' -- missing Endgame and Far From Home
)
AND t.kind_id = 1 -- movie
AND cn.name = 'Marvel Studios' -- Marvel Studios
AND mi.info_type_id = 18 -- just location info
GROUP BY mi.info
HAVING total_movies > 2 -- top 9 locations had 3+ films
ORDER BY total_movies DESC;
```

```{r Plot_Top_Sites, fig.height=4, fig.align='center'}
# plot how many MCU movies were filmed at each of the top locations
top_site_plot <- ggplot(data = top_locations, aes(x = reorder(site, total_movies), y = total_movies)) +
  labs(title = "Where has Marvel filmed the most movies?",
       caption = "Source: IMDB") +
  geom_col(fill = "#8864b0") +
  coord_flip() +
  theme(text = element_text(family = "Arial"),
        rect = element_rect(fill = "gray75"),
        plot.title = element_text(size = 18, hjust = 0.5, vjust = -0.25),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank(),
        panel.grid = element_blank(),
        panel.background = element_blank()) +
  scale_y_continuous(expand = c(0, 0.3)) +
  geom_text(aes(label = c("  Los Angeles, California, USA", # labels by hand bc some too long
                          "  New York City, New York, USA",
                          "  Atlanta, Georgia, USA",
                          "  Pinewood Atlanta Studios, Georgia, USA",
                          "  Raleigh Manhattan Beach Studios, California, USA",
                          "  Shepperton Studios, England, UK",
                          "  London, England, UK",
                          "  Longcross Studios, England, UK",
                          "  Bourne Woods, England, UK")),
            size = 3,
            position = position_stack(0),
            hjust = 0) +
  geom_text(aes(label = total_movies), hjust = 0, nudge_y = 0.1)

top_site_plot
```

```{sql, connection=db, output.var="top_location_movies"}
-- what movies were filmed at the top 9 locations?
SELECT tloc.info site, mloc.title, mloc.production_year
FROM
(SELECT mi.info, sum(1) total_movies
FROM imdb.title t
JOIN movie_companies mc ON t.id = mc.movie_id
JOIN company_name cn ON mc.company_id = cn.id
JOIN movie_info mi ON t.id = mi.movie_id
WHERE t.id IN ( -- movie list compiled based off previous query
	-- phase 1
	'3759353', '4369971', '3759356', '4454099',
	'3400748', '4316706',
  -- phase 2
  '3759369', '4454124', '3400755', '3665599',
  '3313672', '3292159',
  -- phase 3
  '3400744', '3521133', '3665600', '4252963',
  '4454122', '3358206', '3313680', '3292160',
  '3400994' -- missing Endgame and Far From Home
)
AND t.kind_id = 1 -- movie
AND cn.name = 'Marvel Studios' -- Marvel Studios
AND mi.info_type_id = 18 -- just location info
GROUP BY mi.info
ORDER BY total_movies DESC
LIMIT 0, 9) tloc
-- starting second table
JOIN
(SELECT mi2.info, t2.title, t2.production_year
FROM imdb.title t2
JOIN movie_companies mc2 ON t2.id = mc2.movie_id
JOIN company_name cn2 ON mc2.company_id = cn2.id
JOIN movie_info mi2 ON t2.id = mi2.movie_id
WHERE t2.id IN ( -- movie list compiled based off previous query
	-- phase 1
	'3759353', '4369971', '3759356', '4454099',
	'3400748', '4316706',
  -- phase 2
  '3759369', '4454124', '3400755', '3665599',
  '3313672', '3292159',
  -- phase 3
  '3400744', '3521133', '3665600', '4252963',
  '4454122', '3358206', '3313680', '3292160',
  '3400994' -- missing Endgame and Far From Home
)
AND t2.kind_id = 1 -- movie
AND cn2.name = 'Marvel Studios' -- Marvel Studios
AND mi2.info_type_id = 18 -- just location info
) mloc
ON tloc.info = mloc.info
ORDER BY tloc.total_movies DESC, tloc.info, mloc.production_year;
```

**Table of Movies Filmed at Top Locations**

```{r Show_Top_Sites}
# show the table of movies filmed at top locations
top_location_movies
```

It also turns out that forest scenes in [*Captain America: The First Avenger (2011)*](https://youtu.be/QAoD6-CF9Jo?t=63), [*Thor: The Dark World (2013)*](https://youtu.be/opK7mPZtBSI)\*, and [*Avengers: Age of Ultron (2015)*](https://youtu.be/gjq6jwgSk64)\* were all filmed in the same forest: [Bourne Woods](https://en.wikipedia.org/wiki/Bourne_Wood) in Farnham, Surrey, England. Upon further investigation, many other hit movies have filmed in Bourne Woods as well!

```{sql, connection = db, output.var = "bourne_woods"}
-- Find movies which filmed in Bourne Woods
SELECT t.title, t.production_year
FROM imdb.title t
JOIN movie_info mi ON t.id = mi.movie_id
WHERE mi.info_type_id = 18
AND mi.info = 'Bourne Woods, Farnham, Surrey, England, UK'
ORDER BY production_year DESC;
```

**Table of Movies Filmed in Bourne Woods**
```{r Show_Woods_Table}
# show table of movies which filmed in Bourne Woods
bourne_woods
```

## Analysis: Budget and Filming Locations

Next, I wondered: "Do movies with higher budgets get to film in more locations?" Thus, I plotted number of filming locations versus budget. (I excluded movies whose budgets were not finalized when my copy of the dataset was published, hence the cutoff at 2017.)

```{sql, connection=db, output.var="locs_budget"}
-- create table with budget and # filming locations of all MCU movies in dataset
SELECT loc.title, loc.production_year, loc.total_sites, bud.info budget
FROM
-- count number of production locations for each movie
(SELECT t.id, t.title, t.production_year, sum(1) total_sites
FROM imdb.title t
JOIN movie_companies mc ON t.id = mc.movie_id
JOIN company_name cn ON mc.company_id = cn.id
JOIN movie_info mi ON t.id = mi.movie_id
WHERE t.id IN ( -- movie list compiled based off previous query
	-- phase 1
	'3759353', '4369971', '3759356', '4454099',
	'3400748', '4316706',
  -- phase 2
  '3759369', '4454124', '3400755', '3665599',
  '3313672', '3292159',
  -- phase 3
  '3400744', '3521133', '3665600', '4252963',
  '4454122', '3358206', '3313680', '3292160',
  '3400994' -- missing Endgame and Far From Home
)
AND t.kind_id = 1 -- movie
AND cn.name = 'Marvel Studios' -- Marvel Studios
AND mi.info_type_id = 18 -- location info
GROUP BY t.id
ORDER BY t.production_year -- in order of production 
) loc
JOIN -- newest movies have NA budget - can see with left join
-- budget for each movie
(SELECT mi.movie_id id, mi.info
FROM imdb.movie_info mi
WHERE mi.info_type_id = 105) bud
ON loc.id = bud.id;
```

```{r Budget_To_Integer}
# turn budgets into integers
locs_budget <- locs_budget %>%
  mutate(budget = budget %>%
           str_remove_all("[,\\$]") %>%
           as.numeric()) # \\ to escape $ in regex
```

```{r Plot_Site_vs_Budget, fig.align='center'}
# plot locations vs. budgets
library(ggrepel)
site_bud_plot <- ggplot(data = locs_budget, aes(x = budget, y = total_sites)) +
  geom_point() +
  geom_label_repel(aes(label = paste0(title, " (", production_year, ")")),
             color = "black",
             fill = "#8864b0",
             size = 3) +
  scale_x_continuous(name = "Budget, Millions USD",
                     labels = c("125", "150", "175", "200", "225", "250")) +
  scale_y_continuous(name = "Total Filming Locations",
                     expand = c(0, 0),
                     limits = c(0, 26)) +
  labs(title = "No Connection Between Travel and Budget",
       subtitle = "MCU movie budgets don't correspond with number of filming locations",
       caption = "Source: IMDB") +
  theme(text = element_text(family = "Arial"),
        rect = element_rect(fill = "gray75"),
        axis.ticks = element_blank(),
        panel.grid = element_line(color = "gray90"),
        panel.background = element_blank())

site_bud_plot
```

It looks like a larger production budget doesn't help Marvel film at more locations. *Captain America: Civil War* (2016) filmed in fewer locations than *Iron Man* (2008) on almost twice the budget. And with advances in CGI to generate [landscapes in space](https://www.youtube.com/watch?v=ISTZYZq1H80), *Guardians of the Galaxy Vol. 2* (2017) filmed in only three locations on a $200 million budget.[^GoG2]

[^GoG2]: Since this dataset was saved, IMDB added a few [additional locations](https://www.imdb.com/title/tt3896198/locations?ref_=tt_dt_dt) for *Guardians of the Galaxy Vol. 2*, but they are still all within Georgia.

I will concede that Marvel Studios films are all very well-funded. Perhaps with a more diverse set of films, a larger budget would make a greater difference in access to production locations. I also did not account for distance between locations. *Iron Man* (2008) only filmed near LA and Las Vegas, while *Avengers: Age of Ultron* (2016) filmed on four different continents, yet I count both as 20+ filming locations. Thus, budget can certainly impact filming locations, just not the way I counted for MCU films.

## And Finally, the Map

After all of this, where *does* Marvel film? Explore this map of all 204 production locations.[^locs]

[^locs]: I excluded a few country-level and state-level locations (such as "USA" or "California, USA"), because more specific locations were available for the productions. All coordinates from Google Maps.

```{sql, connection=db, output.var="locations"}
-- finding locations without repeats
SELECT mi.info site
FROM imdb.title t
JOIN movie_companies mc ON t.id = mc.movie_id
JOIN company_name cn ON mc.company_id = cn.id
JOIN movie_info mi ON t.id = mi.movie_id
WHERE t.id IN ( -- movie list compiled based off previous query
	-- phase 1
	'3759353', '4369971', '3759356', '4454099',
	'3400748', '4316706',
  -- phase 2
  '3759369', '4454124', '3400755', '3665599',
  '3313672', '3292159',
  -- phase 3
  '3400744', '3521133', '3665600', '4252963',
  '4454122', '3358206', '3313680', '3292160',
  '3400994' -- missing Endgame and Far From Home
)
AND t.kind_id = 1 -- movie
AND cn.name = 'Marvel Studios' -- Marvel Studios
AND mi.info_type_id = 18 -- just location info
GROUP BY mi.info -- remove repeat locations
ORDER BY t.production_year; -- in order of production 
```

```{r}
# storing coordinates for all 204 locations
# (excluding a few non-specific locations like "USA" or "California, USA")
loc_coords <- tribble(
  ~location, ~lat, ~lon,
  "Palmdale Regional Airport, Palmdale, California, USA", 34.627638, -118.082954,
  "Santa Monica Pier, Santa Monica, California, USA", 34.010862, -118.496101,
  "Alabama Hills, Lone Pine, California, USA", 36.567916, -118.091097,
  "Los Angeles, California, USA", 34.051290, -118.261787,
  "Blue Cloud Movie Ranch - 20000 Blue Cloud Road, Santa Clarita, California, USA", 34.470163, -118.484834,
  "Caesars Palace - 3570 Las Vegas Boulevard South, Las Vegas, Nevada, USA", 36.116350, -115.174510,
  "California Steel Industries - 14000 San Bernardino Avenue, Fontana, California, USA", 34.077863, -117.493174,
  "Discovery Drive, Irvine, California, USA", 33.664494, -117.757138,
  "Edwards Air Force Base, California, USA", 34.911018, -117.917503,
  "Hughes Aircraft - 909 N. Sepulveda Boulevard, El Segundo, California, USA", 33.885092, -118.396532,
  "Lone Pine, California, USA", 36.590264, -118.062324,
  "Long Beach, California, USA", 33.791864, -118.137330,
  "Malibu, California, USA", 34.045765, -118.675523,
  "Olancha, California, USA", 36.278703, -118.002041,
  "Playa Vista, California, USA", 33.976176, -118.419692,
  "Point Dume, Malibu, California, USA", 34.001780, -118.806512,
  "Walt Disney Concert Hall - 111 S. Grand Avenue, Downtown, Los Angeles, California, USA", 34.055387, -118.249824,
  "Willow Film Ranch, Rosamond, California, USA",  34.872832, -118.163587,
  "Cherry Street Bridge, Toronto, Ontario, Canada", 43.641429, -79.349224,
  "University of Toronto, Toronto, Ontario, Canada", 43.664476, -79.395826,
  "Koffler Student Services Centre, University of Toronto, Toronto, Ontario, Canada", 43.658900, -79.396915,
  "Convocation Hall, University of Toronto, Toronto, Ontario, Canada", 43.660790, -79.395466,
  "Knox College, University of Toronto, Toronto, Ontario, Canada", 43.661148, -79.396935,
  "Under the Gardiner Expressway, Lakeshore Blvd., Toronto, Ontario, Canada", 43.649848, -79.350436,
  "Arlington, Virginia, USA", 38.880271, -77.106969,
  "Belleville, Ontario, Canada", 44.170096, -77.384815,
  "Canadian Forces Base, Trenton, Ontario, Canada", 44.116320, -77.529676,
  "Consumer's Glass Factory, Hamilton, Ontario, Canada", 43.255251, -79.827809,
  "Drew University - 36 Madison Avenue, Madison, New Jersey, USA", 40.760757, -74.427452,
  "Dundas, Ontario, Canada", 43.266541, -79.956875,
  "Dundurn Castle, Hamilton, Ontario, Canada", 43.269567, -79.884285,
  "Favela Tavares Bastos, Rio de Janeiro, Rio de Janeiro, Brazil", -22.927382, -43.182253,
  "Favela da Rocinha, Rio de Janeiro, Rio de Janeiro, Brazil", -22.987785, -43.248325,
  "Hamilton, Ontario, Canada", 43.255990, -79.881191,
  "Rio de Janeiro, Rio de Janeiro, Brazil", -22.931212, -43.484063,
  "Santa Monica, California, USA", 34.016171, -118.496919,
  "Toronto Film Studios, Toronto, Ontario, Canada", 43.649169, -79.343050,
  "Toronto, Ontario, Canada", 43.727495, -79.386506,
  "Trenton, Ontario, Canada", 44.102505, -77.576527,
  "Vancouver, British Columbia, Canada", 49.282667, -123.125887,
  "Yonge Street, Toronto, Ontario, Canada", 43.748610, -79.407808,
  "D.C. Stages, 1360 East 6th Street, Downtown, Los Angeles, California, USA", 34.038052, -118.233624,
  "SpaceX - Rocket Road, Hawthorne, California, USA", 33.920716, -118.328293,
  "85 W State St, Pasadena, California, USA", 34.125442, -118.152104,
  "Downey Studios - 12214 Lakewood Boulevard, Downey, California, USA", 33.921310, -118.132397,
  "Hawthorne, California, USA", 33.916428, -118.348612,
  "The Huntington Library, Art Collections, and Botanical Gardens - 1151 Oxford Rd, San Marino, California, USA", 34.129107, -118.114524,
  "Inglewood, California, USA", 33.962179, -118.353854,
  "L.A. Live, Downtown, Los Angeles, California, USA", 34.044740, -118.265365,
  "La Condamine, Monaco", 43.734835, 7.422391,
  "Monte Carlo, Monaco", 43.740162, 7.426589,
  "Mystery Mesa, California, USA", 37.417512, -118.542207,
  "Pasadena, California, USA", 34.157904, -118.141861,
  "Playa del Rey, Los Angeles, California, USA", 33.956288, -118.441103,
  "Randy's Donuts - 805 W. Manchester Avenue, Inglewood, California, USA", 33.961869, -118.370344,
  "Sepulveda Dam, Encino, Los Angeles, California, USA", 34.166708, -118.474252,
  "Sony Pictures Studios - 10202 W. Washington Blvd., Culver City, California, USA", 34.017702, -118.401060,
  "Van Nuys, Los Angeles, California, USA", 34.190339, -118.453073,
  "Stanley Dock, Liverpool, Merseyside, England, UK", 53.421537, -2.998517,
  "Northern Quarter, Manchester, England, UK", 53.482518, -2.234665,
  "Aldershot, Hampshire, England, UK", 51.248381, -0.755734,
  "Caerwent, Monmouthshire, Wales, UK", 51.610760, -2.764748,
  "Culross, Fife, Scotland, UK", 56.055182, -3.629823,
  "Downtown, Los Angeles, California, USA", 34.040783, -118.247895,
  "Liverpool, Merseyside, England, UK", 53.418571, -2.923594,
  "Manchester, Greater Manchester, England, UK", 53.480883, -2.242633,
  "Manhattan Beach, California, USA", 33.890480, -118.396164,
  "Pinewood Studios, Iver Heath, Buckinghamshire, England, UK", 51.548666, -0.534957,
  "Raleigh Manhattan Beach Studios - 1600 Rosecrans Avenue, Manhattan Beach, California, USA", 33.901611, -118.384200,
  "San Marino, California, USA", 34.125411, -118.112821,
  "Simi Valley, California, USA", 34.268910, -118.782242,
  "Universal Studios - 100 Universal City Plaza, Universal City, California, USA", 34.138122, -118.353378,
  "Galisteo, New Mexico, USA", 35.395894, -105.946864,
  "The Getty Center - 1200 Getty Center Drive, Brentwood, Los Angeles, California, USA", 34.078038, -118.474097,
  "Granada Hills, Los Angeles, California, USA", 34.279545, -118.502356,
  "La Jolla, San Diego, California, USA", 32.832411, -117.272627,
  "Santa Fe, New Mexico, USA", 35.693433, -105.942489,
  "Pittsburgh, Pennsylvania, USA", 40.436444, -79.995601,
  "Inyokern, California, USA", 35.647089, -117.812670,
  "Lakeside Court House, Cleveland, Ohio, USA", 41.503465, -81.696967,
  "Ameritrust Rotunda, Cleveland, Ohio, USA", 41.500145, -81.686119,
  "Cedar Avenue and Ashland Road, Cleveland, Ohio, USA", 41.500553, -81.648424,
  "Albuquerque Studios - 5650 University Boulevard SE, Albuquerque, New Mexico, USA", 34.989018, -106.613701,
  "Cincinnati, Ohio, USA", 39.105781, -84.517180,
  "East 9th St, Cleveland, Ohio, USA", 41.501031, -81.687446,
  "Grumman Aerospace Factory, Bethpage, Long Island, New York, USA", 40.758182, -73.498803,
  "NASA Glenn Center, North Olmsted, Ohio, USA", 41.416106, -81.858256,
  "Parma, Ohio, USA", 41.405197, -81.722373,
  "Public Square, Cleveland, Ohio, USA", 41.499696, -81.693676,
  "Plum Brook Station, Sandusky, Ohio, USA", 41.359155, -82.644165,
  "Wilmington, Ohio, USA", 39.445759, -83.828719,
  "Wright-Patterson Air Force Base, Fairborn, Ohio, USA", 39.814957, -84.054659,
  "Cary, North Carolina, USA", 35.755980, -78.733661,
  "Miami, Florida, USA", 25.761505, -80.188918,
  "Epic Games, Cary, North Carolina, USA", 35.752399, -78.741979,
  "Kenansville, North Carolina, USA", 34.961801, -77.962023,
  "Oak Island, North Carolina, USA", 33.904194, -78.082324,
  "Rose Hill, North Carolina, USA", 34.826349, -78.021872,
  "Currie, North Carolina, USA", 34.462502, -78.101016,
  "Hollywood, Los Angeles, California, USA", 34.134459, -118.321454,
  "Hollywood Boulevard, Hollywood, Los Angeles, California, USA", 34.101640, -118.328198,
  "Grauman's Chinese Theater - 6925 Hollywood Blvd., Hollywood, Los Angeles, California, USA", 34.101757, -118.340964,
  "Villa Vizcaya - 3251 S. Miami Avenue, Miami, Florida, USA", 25.744391, -80.210477,
  "Screen Gems Studios - 1223 North 23rd Street, Wilmington, North Carolina, USA", 34.253516, -77.921216,
  "Wilmington, North Carolina, USA", 34.210480, -77.886835,
  "Old Royal Naval College, Greenwich, London, England, UK", 51.483690, -0.005911,
  "Reykjavík, Iceland", 64.120309, -21.837832,
  "Skógarfoss Waterfall, Iceland", 63.532083, -19.511426,
  "Stonehenge, Salisbury Plain, Wiltshire, England, UK", 51.178890, -1.826216,
  "Blythe House, 23 Blythe Road, West Kensington, London, England, UK", 51.496513, -0.213689,
  "EMI, Blyth Road, Hayes, Middlesex, England, UK", 51.504089, -0.429257,
  "OXO Tower, South Bank, Lambeth, London, England, UK", 51.508412, -0.108508,
  "Ironmonger Lane, London, England, UK", 51.514469, -0.091856,
  "Cleveland, Ohio, USA", 41.467385, -81.679408,
  "Washington, District of Columbia, USA", 38.889293, -77.048307,
  "Oakland, California, USA", 37.804535, -122.271150,
  "Baltimore, Maryland, USA", 39.290405, -76.612210,
  "Cleveland Museum of Art, Cleveland, Ohio, USA", 41.509051, -81.612073,
  "West 3rd and Lakeside Avenue, Cleveland, Ohio, USA", 41.502109, -81.698422,
  "Euclid Avenue, Cleveland, Ohio, USA", 41.522403, -81.59035,
  "E. 6th and Rockwell Avenue, Cleveland, Ohio, USA", 41.502062, -81.690903,
  "Tower City, Cleveland, Ohio, USA", 41.497043, -81.693440,
  "Lakeview Cemetery, Cleveland, Ohio, USA", 41.513795, -81.598215,
  "West Shoreway, Cleveland, Ohio, USA", 41.482096, -81.730893,
  "E. 3rd and Superior Avenue, Cleveland, Ohio, USA", 41.500587, -81.691815,
  "Lorain Avenue Bridge, Rocky River, Ohio, USA", 41.451511, -81.824799,
  "Santa Clarita, California, USA", 34.392489, -118.541492,
  "Camp Ravenna Joint Military Training Center, Ohio, USA", 41.167225, -81.085216,
  "Millennum Bridge, River Thames, London, England, UK", 51.509526, -0.098518,
  "Liége Guillemins railway station, Belgium", 50.624487, 5.566697,
  "Shepperton Studios, Shepperton, Surrey, England, UK", 51.407843, -0.466144,
  "Johannesburg, South Africa", -26.187916, 28.043016,
  "Seoul, South Korea", 37.580330, 126.976941,
  "Fortress, Aosta Valley, Italy", 45.608310, 7.744528,
  "London, England, UK", 51.500946, -0.124536,
  "Mapo Bridge, Seoul, South Korea", 37.533811, 126.937104,
  "Floating Island, Seoul, South Korea", 37.511730, 126.994896,
  "Ttukseom Hangang Park, Seoul, South Korea", 37.529136, 127.071342,
  "Digital Media City, Seoul, South Korea", 37.580246, 126.890680,
  "Cheongdam Bridge, Seoul, South Korea", 37.526587, 127.064455,
  "Hawley Woods, Farnborough, Hampshire, England, UK", 51.317990, -0.773494,
  "Aosta, Valle d'Aosta, Italy", 45.734966, 7.312519,
  "Sainsburys Centre for Visual Arts, University of East Anglia, Norwich, Norfolk, England, UK", 52.620417, 1.234652,
  "Dover Castle Tunnels, Dover, Kent, England, UK", 51.128786, 1.323376,
  "Hendon Police College, London, England, UK", 51.593851, -0.240646,
  "Royal Holloway College, Egham, Surrey, England, UK", 51.425639, -0.563053,
  "Chittagong, Bangladesh", 22.357612, 91.783413,
  "Bourne Woods, Farnham, Surrey, England, UK", 51.192757, -0.771161,
  "Stratfield Saye House, Hampshire, England, UK", 51.349035, -0.996075,
  "The Printworks, Associated Newspapers Print Works, Canada Water, London, England, UK", 51.497848, -0.043975,
  "Kathmandu, Nepal", 27.708624, 85.317396,
  "Longcross Studios, Chobham Lane, Longcross, Surrey, England, UK", 51.383305, -0.593829,
  "CBS Studio Center - 4024 Radford Avenue, Studio City, Los Angeles, California, USA", 34.144616, -118.392305,
  "Hong Kong, China", 22.323034, 114.169107,
  "Shepperton Studios, London, England, UK", 51.407829, -0.466123,
  "Deerpark, New York, USA", 41.385951, -74.647301,
  "Northfleet Industrial Estate, Gravesham, Kent, England, UK", 51.451429, 0.317359,
  "Cartersville, Georgia, USA", 34.165314, -84.799202,
  "Berlin, Germany", 52.516277, 13.377744,
  "Van Nuys High School - 6535 Cedros Avenue, Van Nuys, Los Angeles, California, USA", 34.189236, -118.455172,
  "Reseda High School - 18230 Kittridge Avenue, Reseda, Los Angeles, California, USA", 34.190007, -118.530291,
  "Franklin K. Lane High School - 999 Jamaica Avenue, Brooklyn, New York City, New York, USA", 40.692859, -73.868998,
  "Sunnyside, Queens, New York City, New York, USA", 40.743261, -73.919937,
  "44-11 Queens Boulevard, Queens, New York City, New York, USA", 40.743670, -73.919984,
  "Henry W. Grady High School - 929 Charles Allen Drive N.E., Atlanta, Georgia, USA", 33.780562, -84.371419,
  "Staten Island Ferry, New York Harbor, New York City, New York, USA", 40.618077, -74.066642,
  "Washington Monument - 15th Street & Constitution Avenue NW, National Mall, Washington, Columbia, USA", 38.889504, -77.035292,
  "Village Roadshow Studios, Oxenford, Queensland, Australia", -27.912449, 153.313369,
  "Brisbane, Queensland, Australia", -27.469730, 153.025106,
  "Mount Tamborine, Queensland, Australia", -27.923042, 153.171660,
  "Atlanta, Georgia, USA", 33.749024, -84.388068,
  "Pinewood Atlanta Studios, 461 Sandy Creek Road, Fayetteville, Georgia, USA", 33.473158, -84.512529,
  "Waverly Train Station, Edinburgh, Scotland, UK", 55.952005, -3.189970,
  "Cockburn Street, Edinburgh, Scotland, UK", 55.950630, -3.189880,
  "Durham Cathedral, Durham, County Durham, England, UK", 54.773241, -1.576389,
  "New York City, New York, USA", 40.678983, -73.941988,
  "St Abbs Head, Berwickshire, Scotland, UK", 55.916376, -2.141141,
  "Fairburn, Georgia, USA", 33.567116, -84.581269,
  "Iguazú Waterfalls, Misiones, Argentina", -25.695226, -54.436685,
  "Sweet Auburn, Atlanta, Georgia, USA", 33.753779, -84.376634,
  "Busan, South Korea", 35.179549, 129.075611,
  "Gwangalli Beach, Busan, South Korea", 35.153183, 129.118660,
  "Gwangan Bridge, Busan, South Korea", 35.147701, 129.129982,
  "Jagalchi Market, Busan, South Korea", 35.096720, 129.030480,
  "Haeundae Marine City, Busan, South Korea", 35.155331, 129.145927,
  "Haeundae Gwajeong Bridge, Busan, South Korea", 35.147693, 129.130018,
  "The north side of the Sajik Baseball Stadium, Busan, South Korea", 35.194043, 129.061507,
  "The slope of Dongseo University in Busan, South Korea", 35.143924, 129.010561,
  "Namhang Bridge in Busan, South Korea", 35.080390, 129.032195,
  "San Francisco, California, USA", 37.774967, -122.419391,
  "Tenderloin, San Francisco, California, USA", 37.784675, -122.414554,
  "Buena Vista Park, San Francisco, California, USA", 37.768455, -122.441436,
  "Peachtree City, Georgia, USA", 33.397702, -84.596995,
  "Conzelman Road, Marin Headlands, California, USA", 37.827192, -122.499264,
  "Puerto Rico", 18.233265, -66.580248,
  "Potsdamer Platz, Mitte, Berlin, Germany", 52.509235, 13.376642,
  "ICC Berlin, Berlin, Germany", 52.503706, 13.279799,
  "Studio Babelsberg, Potsdam, Brandenburg, Germany", 52.387074, 13.120184,
  "Leipzig/Halle Airport, Leipzig, Saxony, Germany", 51.422101, 12.220391,
  "Spree River, Berlin, Germany", 52.447572, 13.574614,
  "Siegessäule, Tiergarten, Berlin, Germany", 52.514556, 13.350109,
  "Messedamm, Berlin, Germany", 52.503546, 13.278172,
  "Leipziger Straße, Mitte, Berlin, Germany", 52.510446, 13.390308,
  "Clayton State University, Morrow, Georgia, USA", 33.594375, -84.330368
)
```

```{r}
# join coordinates with locations
# use table that does include repeats
mcu_locations_lat_lon <- mcu_locations %>%
  right_join(loc_coords, by = c("site" = "location")) # exclude rows of excluded locations
```

```{r}
# convert coordinates to spatial data
# and duplicate movies to one string
library(sf)
mcu_locations_coords <- mcu_locations_lat_lon %>%
  st_as_sf(coords = c("lon", "lat")) %>% # coordinates to points
  group_by(site) %>% # condense duplicate locations
  summarize(all_titles = paste0(title, " (", # movie title and year
                                production_year, ")",
                                if_else(is.na(note), "", # if note, add it
                                        paste0(" — ", str_sub(note, 2, -2))),
                                collapse = "<br>"),
            multi_point = n() > 1) # boolean - more than one movie at this site?
```

```{r Fix_Punctuation}
# small punctuation fix:
# fix double notes (A) (B) from A) (B to A; B
mcu_locations_coords <- mcu_locations_coords %>%
  mutate(all_titles = str_replace_all(all_titles, "\\) \\(", "; "))
```

```{r Movie_Groups}
# group movies by superhero
mcu_locations_coords <- mcu_locations_coords %>%
  mutate(movie_group = case_when(
              multi_point ~ "Multiple Movies",
              grepl("Iron Man", all_titles) ~ "Iron Man", # 3 Movies
              grepl("Thor", all_titles) ~ "Thor", # 3 Movies
              grepl("Captain America", all_titles) ~ "Captain America", # 3 Movies
              grepl("Avengers", all_titles) ~ "Avengers", # 3 Movies in this dataset
              grepl("Guardians of the Galaxy", all_titles) ~ "Guardians of the Galaxy", # 2 Movies
              grepl("Ant-Man", all_titles) ~ "Ant-Man", # 2 Movies
              grepl("Hulk", all_titles) ~ "Hulk",
              grepl("Doctor Strange", all_titles) ~ "Doctor Strange",
              grepl("Spider-Man", all_titles) ~ "Spider-Man", # Spider-Man (1 movie in this dataset)
              grepl("Black Panther", all_titles) ~ "Black Panther",
              grepl("Captain Marvel", all_titles) ~ "Captain Marvel", # never used
              TRUE ~ "Other"))  # default - never used
```

```{r Icon_Function}
# for making icons for different groups
make_icon <- function(group = "Other") {
  # find corresponding color for group
  color <- case_when( # for different marker colors
              group == "Multiple Movies" ~ "gray",
              group == "Iron Man" ~ "red", # 3 Movies
              group == "Thor" ~ "purple", # 3 Movies
              group == "Captain America" ~ "darkblue", # 3 Movies
              group == "Avengers" ~ "darkpurple", # 3 Movies in this dataset
              group == "Guardians of the Galaxy" ~ "orange", # 2 Movies
              group == "Ant-Man" ~ "beige", # 2 Movies
              group == "Hulk" ~ "green",
              group == "Doctor Strange" ~ "pink",
              group == "Spider-Man" ~ "darkred", # Spider-Man (1 movie in this dataset)
              group == "Black Panther" ~ "black",
              group == "Captain Marvel" ~ "blue", # never used
              TRUE ~ "blue")
  
  # now make marker
  makeAwesomeIcon(icon = "glyphicon-star",
                            library = "glyphicon",
                            markerColor = color,
                            iconColor = "white")
}
```

```{r Make_Map, fig.width = 8, fig.height = 4}
# plot the filming locations on the map
library(leaflet)

map <- leaflet() %>%
  addTiles() %>%
  addAwesomeMarkers(data = mcu_locations_coords,
                    popup = ~paste0("<b>",
                                   site,
                                   "</b><br>",
                                   all_titles),
                    group = ~movie_group,
                    # Icon color based on group
                    icon = ~make_icon(movie_group)) %>%
  # I made my own vector of groups to maintain order proper order
  addLayersControl(overlayGroups = c("Multiple Movies", "Iron Man", "Thor",
                                     "Captain America", "Avengers",
                                     "Guardians of the Galaxy", "Ant-Man", "Hulk",
                                     "Doctor Strange", "Spider-Man",
                                     "Black Panther"))

# so awesomeIcon CSS doesn't interfere with the theme
frameWidget(map)
```

It turns out that Iron Man only filmed in the US, Doctor Strange never [visited Mount Everest](https://youtu.be/49pIVYbWJ_E?t=105), and Black Panther's [iconic waterfall](https://youtu.be/V0OGG-FLPU0?t=8) [battle scenes](https://www.youtube.com/watch?v=xJprg7mWli0) were actually filmed in South America. Some of our favorite Marvel landscapes are, in reality, movie magic.

Still, it's exciting to find Marvel filming locations across six different continents. Here are some of my favorite discoveries on the map:

* [Culross, Fife, Scotland](https://www.dailyrecord.co.uk/news/scottish-news/marvels-scottish-connections-explored-blockbuster-9593276) is home to **Brooklyn Antiques**, the storefront of the secret laboratory where Captain America received the supersoldier serum.

* The **Avengers Training Facility** is actually the Sainsburys Centre for Visual Arts, University of East Anglia, Norwich, Norfolk, England, UK.

* **Rose Hill, TN** in Iron Man Three is actually Rose Hill, NC, in my home state. Some filming for the movie took place 30 minutes from my home at [Epic Games](https://www.wral.com/entertainment/story/11168839/) — also known as the creators of Fortnite!

When *Black Widow* is finally released in November, it will be Marvel's first time filming in Budapest. Marvel may mostly film in the US and UK, but with a bit of post-production magic, the movies take us [across nine realms](https://youtu.be/NMmoo7_kv3A?t=80), [through the stars](https://www.youtube.com/watch?v=AAmAqfV22sk), and into [infinite new universes](https://youtu.be/XSkerpBaoR8).

Were you surprised at some of your favorite movies' filming locations? Did Marvel film near you? Let me know in the comments below or follow me on Twitter at [\@KHablutzel](https://twitter.com/KHablutzel)!

---

## Word count

```{r word_count, message=FALSE, echo=FALSE}
sds192::text_stats()
```

